<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>🔒 Protnut OEM Portal</title>
  <!-- Bootstrap CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Firebase SDKs (假設已包含，原文件未顯示) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <!-- 你的app.js -->
  <script src="app.js"></script>
  <style>
    .hidden { display: none; }
    body { background-color: #f8f9fa; }
    .card { margin-bottom: 1rem; }
  </style>
</head>
<body class="container mt-5">
  <div id="auth-area">
    <div class="row">
      <div class="col-md-6">
        <h3>註冊帳號</h3>
        <p>申請註冊<br>僅允許公司信箱 (.com / .com.tw / .net)<br>禁止 Gmail / Yahoo / Outlook 等免費信箱</p>
        <input type="email" id="su-email" class="form-control mb-2" placeholder="Email">
        <input type="password" id="su-pw" class="form-control mb-2" placeholder="密碼">
        <button id="btn-signup" class="btn btn-primary">註冊</button>
      </div>
      <div class="col-md-6">
        <h3>登入帳號</h3>
        <input type="email" id="li-email" class="form-control mb-2" placeholder="Email">
        <input type="password" id="li-pw" class="form-control mb-2" placeholder="密碼">
        <button id="btn-login" class="btn btn-success">登入</button>
      </div>
    </div>
    <div id="auth-msg" class="text-danger mt-3"></div>
  </div>

  <div id="user-area" class="hidden">
    <h2>歡迎, <span id="user-email"></span> <span id="user-note"></span></h2>
    <button id="btn-logout" class="btn btn-danger">登出</button>
    <button id="btn-new-project" class="btn btn-primary ms-2">➕ 建立新專案</button>
    <button id="btn-view-projects" class="btn btn-info ms-2">📂 我的專案</button>

    <!-- 新增: 流程教學區塊 -->
    <div id="tutorial-area" class="mt-4 card p-3">
      <h4>代工專案申請報價流程教學</h4>
      <ol>
        <li><strong>建案</strong>: 點擊"建立新專案"，輸入標題並上傳初始檔案。</li>
        <li><strong>上傳</strong>: 上傳設計、規格、2D/3D drawing等文件（支援多檔，除.exe外）。確認後按"完成"進入DFM。</li>
        <li><strong>DFM</strong>: 公司評估製造風險，討論修正後上傳報告。</li>
        <li><strong>報價</strong>: 公司基於DFM提供報價（含模具等）。</li>
        <li><strong>下單</strong>: 您確認報價，上傳PO訂單。</li>
        <li><strong>打樣</strong>: 公司製造樣品。</li>
        <li><strong>交貨</strong>: 出貨附檢驗報告。</li>
      </ol>
      <p>每個任務僅負責者可確認完成，系統會自動通知下一方（email）。</p>
    </div>

    <div id="new-project-area" class="hidden mt-4 card p-3">
      <h4>建立新專案</h4>
      <input type="text" id="proj-title" class="form-control mb-2" placeholder="專案名稱">
      <!-- 修改: 支援多檔上傳 -->
      <input type="file" id="proj-files" class="form-control mb-2" multiple accept="*/*" onchange="validateFiles(this)">
      <button id="btn-create-project" class="btn btn-success">送出專案</button>
    </div>

    <div id="projects-list" class="hidden mt-4">
      <h3>我的專案</h3>
      <div id="projects-container"></div> <!-- 這裡會用表格顯示清單 -->
    </div>
  </div>

  <div id="admin-area" class="hidden mt-5">
        <h4>管理員控制台</h4>

        <!-- 待審核用戶 -->
        <div class="card">
          <h5>待審核帳號</h5>
          <div id="pending-list"></div>
        </div>

        <!-- 所有專案 -->
        <div class="card">
          <h5>所有專案</h5>
          <div id="admin-projects"></div>
        </div>

        <!-- 通知 -->
        <div class="card">
          <h5>最新通知</h5>
          <div id="notifications"></div>
        </div>
              <h5>手動新增用戶（非允許域名）</h5>
        <input type="email" id="admin-new-email" placeholder="Email">
        <input type="password" id="admin-new-pw" placeholder="密碼">
        <button onclick="adminAddUser(document.getElementById('admin-new-email').value, document.getElementById('admin-new-pw').value)">新增</button>
      </div>

  <!-- ===== JS ===== -->
  <script src="js/jquery-3.2.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <script>
    // TODO: 換成你的 Firebase 專案設定
    const firebaseConfig = {
        apiKey: "AIzaSyCyL5D-TzMUL2LMWubzNiQCnBzQbJVcsZ0",
          authDomain: "protnut711.firebaseapp.com",
          projectId: "protnut711",
          storageBucket: "protnut711.firebasestorage.app",
          messagingSenderId: "891034366919",
          appId: "1:891034366919:web:95e24c97db6abd976d5fe2",
          measurementId: "G-KEZDX0E972"
        };
    firebase.initializeApp(firebaseConfig);
  </script>

  <!-- Portal App Logic -->
  <script src="js/app.js"></script>
</body>
</html>